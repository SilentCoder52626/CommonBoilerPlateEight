@model CelebrityDetailResponseViewModel
@using CommonBoilerPlateEight.Domain.Enums

<div class="row">
    <div class="col-md-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <h6 class="card-title">@_CommonLocalizer["CelebrityDetails"]</h6>

                <div class="table-responsive">
                    <table class="table">

                        <tbody>
                            <tr>
                                <td colspan="2"><h3>@_CommonLocalizer["Details"]</h3></td>
                            </tr>
                            <tr>
                                <td> @_CommonLocalizer["Image"]</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                   <img class="img-lg" src="@(!string.IsNullOrEmpty(Model.ProfileImage) ? Model.ProfileImage :"/images/others/placeholder.jpg")" alt="" id="profileImage" style="width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc;">
                                </div>
                                </td>
                            </tr>
                            <tr>
                                <td> @_CommonLocalizer["FullName"]</td>
                                <td> @Model.FullName</td>
                            </tr>
                            <tr>
                                <td> @_CommonLocalizer["Mobile"]</td>
                                <td>(@Model.CountryDialCode)@Model.MobileNumber</td>
                            </tr>
                            <tr>
                                <td> @_CommonLocalizer["Email"]</td>
                                <td> @Model.Email</td>
                            </tr>
                            <tr>
                                <td> @_CommonLocalizer["CreatedBy"]</td>
                                <td> @Model.CreatedBy</td>
                            </tr>
                            <tr>
                                <td> @_CommonLocalizer["Type"]</td>
                                <td> @Model.CelebrityType</td>
                            </tr>
                           
                             <tr>
                                    <td> @_CommonLocalizer["Gender"]</td>
                                    <td> @Model.Gender</td>
                             </tr>
                             <tr>
                                    <td> @_CommonLocalizer["Price/Post"]</td>
                                    <td> @Model.PricePerAdPost</td>
                             </tr>
                             <tr>
                                    <td> @_CommonLocalizer["Price/Delivery"]</td>
                                    <td> @Model.PricePerDelivery</td>
                             </tr>
                             <tr>
                                    <td> @_CommonLocalizer["Price/Event"]</td>
                                    <td> @Model.PricePerEvent</td>
                             </tr>
                           

                            <tr>
                                <td> @_CommonLocalizer["Status"]</td>
                                <td>
                                    @if (Model.Status == StatusTypeEnum.Pending.ToString())
                                    {
                                        <span class="text-primary">@Model.Status</span>
                                    }
                                    else if (Model.Status == StatusTypeEnum.Approved.ToString())
                                    {
                                        <span class="text-success">@Model.Status</span>
                                    }
                                    else
                                    {
                                        <span class="text-danger">@Model.Status</span>
                                    }

                                </td>
                            </tr>
                            @if (Model.Status == StatusTypeEnum.Approved.ToString())
                            {
                                <tr>
                                    <td>@_CommonLocalizer["ApprovedBy"]</td>
                                    <td>@Model.ApprovedBy</td>
                                </tr>
                            }

                            @if (Model.Status == StatusTypeEnum.Rejected.ToString())
                            {
                                <tr>
                                    <td>@_CommonLocalizer["RejectedBy"]</td>
                                    <td>@Model.RejectedBy</td>
                                </tr>
                                <tr>
                                    <td>@_CommonLocalizer["Comment"]</td>
                                    <td>@Model.RejectionComment</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Model.CivilIdAttachment.FilePath))
                            {
                                <tr>
                                    <td colspan="2"> <h3>@_CommonLocalizer["CivId"]</h3></td>
                                </tr>
                              
                                    <tr>
                                        <td colspan="2">
                                            <a data-url="@Model.CivilIdAttachment.FilePath"  class="attachment-link">@Model.CivilIdAttachment.FileName</a>
                                        </td>
                                    </tr>                              
                            }
                             @if (!string.IsNullOrEmpty(Model.ContractAttachment.FilePath))
                            {
                                <tr>
                                    <td colspan="2"> <h3>@_CommonLocalizer["Contract"]</h3></td>
                                </tr>
                              
                                    <tr>
                                        <td colspan="2">
                                            <a data-url="@Model.ContractAttachment.FilePath"  class="attachment-link">@Model.ContractAttachment.FileName</a>
                                        </td>
                                    </tr>                              
                            }
                        </tbody>
                    </table>

                    @if (Model.Status == StatusTypeEnum.Pending.ToString())
                    {
                        <br />
                        <a class="btn btn-primary" id="approve-celebrity" data-id="@Model.Id">@_CommonLocalizer["Approve"]</a>
                        <a class="btn btn-danger" id="reject-celebrity" data-id="@Model.Id">@_CommonLocalizer["Reject"]</a>
                    }
                </div>
            </div>
        </div>
    </div>

</div>

<div class="modal fade" id="Modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content p-3 p-md-5">
            <button type="button"
                    class="btn-close btn-pinned"
                    data-bs-dismiss="modal"
                    aria-label="Close"></button>
            <div class="modal-body" id="modalContent">
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script>
               ﻿
        $(document).on("click", ".attachment-link", function () {
            let url = $(this).attr("data-url");
            const extension = url.split('.').pop().toLowerCase();
   
            let content;
            if (extension === "pdf") {
                content = `<iframe src="${url}" width="100%" height="600"></iframe>`;
            } else {
                content = `<img src="${url}" class="img-fluid" alt="Attachment"  width="100%" height="600">`;
            }

            $("#modalContent").html(content);
            $("#Modal").modal("show");
        });

        $(document).on("click", "#approve-celebrity", function () {
            const title = "Do you really want to approve?";
            const celebrityId = $(this).attr("data-id");
            ShowDialog("Approver Celebrity", title, "warning").then((result) => {
                if (result.isConfirmed) {
                    blockwindow();
                    $.ajax({
                        type: "Patch",
                        url: "/Celebrity/Approve?id=" + celebrityId,
                        success: function (response) {
                            if (response.Status == "Success") {
                                SuccessToast(response.Message);
                            }
                            else {
                                InfoToast(response.Errors.join("\n"))
                            }
                            unblockwindow()
                            window.location.reload();
                        },
                        error: function (response) {
                            unblockwindow();
                            handleAjaxError(response)
                        },
                    });
                } else {
                }
            });
            return false;
        })

        $(document).on("click", "#reject-celebrity", function () {
            const title = "Do you really want to reject?";
            const celebrityId = $(this).attr("data-id");
            ShowDialogWithTextInput("Reject Celebrity", title, "warning").then((result) => {
                if (result.isConfirmed) {
                    if (!result.value) {
                        InfoToast("Comment is required ");
                        return false;
                    }
                    blockwindow();
                    $.ajax({
                        type: "Patch",
                        url: `/Celebrity/Reject?id=${celebrityId}&comment=${result.value}`,
                        success: function (response) {
                            if (response.Status == "Success") {
                                SuccessToast(response.Message);
                            }
                            else {
                                InfoToast(response.Errors.join("\n"))
                            }
                            unblockwindow()
                            window.location.reload();
                        },
                        error: function (response) {
                            unblockwindow();
                             handleAjaxError(response)
                        },
                    });
                } else {
                }
            });
            return false;
        })
    </script>
}