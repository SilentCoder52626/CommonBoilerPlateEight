@model CelebrityEditViewModel
@{
    ViewBag.ModuleName = _CommonLocalizer["Celebrity"];
    ViewBag.ModuleIcon = "user";
    var countries = ViewBag.Countries as List<CountryResponseViewModel> ?? new List<CountryResponseViewModel>();
    var celebrityTypes = ViewBag.CelebrityTypes as List<CelebrityTypeResponseModel> ?? new List<CelebrityTypeResponseModel>();
    var genders = EnumExtensions.ToDropdownList<GenderTypeEnum>();
    var timeToCall = Model.TimeToCall.HasValue ? Model.TimeToCall.Value.ToString("yyyy-MM-dd hh:mm tt") : string.Empty;
}



<div class="row card">
    <div class="col-md-12 card-body">

        <div class="row">
            <ul class="nav nav-tabs nav-tabs-line" id="lineTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="basic-tab" data-bs-toggle="tab" href="#basic" role="tab" aria-controls="basic" aria-selected="true">@_CommonLocalizer["BD"]</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="social-tab" data-bs-toggle="tab" href="#social" role="tab" aria-controls="social" aria-selected="false">@_CommonLocalizer["Socials"]</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="attachment-tab" data-bs-toggle="tab" href="#attachment" role="tab" aria-controls="attachment" aria-selected="false">@_CommonLocalizer["Attachments"]</a>
                </li>
            </ul>
            <div class="tab-content mt-3" id="lineTabContent">
                <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
                    <form asp-action="EditBasicDetail" asp-controller="Celebrity" method="post" class="forms-celebrity" enctype="multipart/form-data">
                        <input type="hidden" asp-for="Id" />
                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["Image"]</label>
                            <div class="col-sm-9">
                                <div class="d-flex align-items-center">
                                    <img class="img-lg" src="@(!string.IsNullOrEmpty(Model.ProfileImage) ? Model.ProfileImage :"/images/others/placeholder.jpg")" alt="" id="profileImage" style="width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc;">
                                </div>
                                <input type="file" class="form-control mt-1" data-image-container="profileImage" asp-for="ProfileImageFile" accept=".jpg, .jpeg, .png" onchange="previewImage(event)">
                                <span asp-validation-for="ProfileImageFile" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["FullName"]</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="FullName" placeholder="@_CommonLocalizer["FullName"]">
                                <span asp-validation-for="FullName" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["Email"]</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="Email" placeholder="@_CommonLocalizer["Email"]">
                                <span asp-validation-for="Email" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["Gender"]</label>
                            <div class="col-sm-9">
                                @Html.DropDownListFor(a => a.Gender, new SelectList(genders, "Text", "Value"), "--select--", new { @class = "form-control select2Input" })
                                <span asp-validation-for="CelebrityTypeId" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["Type"]</label>
                            <div class="col-sm-9">
                                @Html.DropDownListFor(a => a.CelebrityTypeId, new SelectList(celebrityTypes, "Id", "Name"), _CommonLocalizer["Select"], new { @class = "form-control select2Input" })
                                <span asp-validation-for="CelebrityTypeId" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="exampleInputMobile" class="col-sm-3 col-form-label">@_CommonLocalizer["Mobile"]</label>
                            <div class="col-sm-3">

                                <select asp-for="CountryId" class="select-with-flags" style="width: 100%;">
                                    @foreach (var country in countries)
                                    {
                                        var isSelected = country.Id == Model.CountryId;
                                        if (isSelected)
                                        {
                                            <option value="@country.Id" data-flag="@country.Code.ToLower()" data-dial-code="@country.DialCode" data-country="@country.Name" selected>
                                                @country.DialCode
                                            </option>
                                        }
                                        else
                                        {
                                            <option value="@country.Id" data-flag="@country.Code.ToLower()" data-dial-code="@country.DialCode" data-country="@country.Name">
                                                @country.DialCode
                                            </option>
                                        }

                                    }
                                </select>
                            </div>
                            <div class="col-sm-6">
                                <input type="number" class="form-control" asp-for="MobileNumber" placeholder="@_CommonLocalizer["Mobile"]">
                                <span asp-validation-for="MobileNumber" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["TimeToCall"]</label>
                            <div class="col-sm-9">
                                <div class="input-group">
                                    <input type="text" asp-for="TimeToCall" class="form-control datetime-picker" placeholder="@_CommonLocalizer["Select"]" data-input value="@timeToCall" data-type="datetime" data-show="future">
                                    <span class="input-group-text input-group-addon" data-toggle><i data-feather="calendar"></i></span>
                                </div>

                                <span asp-validation-for="TimeToCall" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["Price/Post"]</label>
                            <div class="col-sm-9">
                                <input type="number" class="form-control" asp-for="PricePerPost" placeholder="@_CommonLocalizer["Price/Post"]">
                                <span asp-validation-for="PricePerPost" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["Price/Event"]</label>
                            <div class="col-sm-9">
                                <input type="number" class="form-control" asp-for="PricePerEvent" placeholder="@_CommonLocalizer["Price/Event"]">
                                <span asp-validation-for="PricePerEvent" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["Price/Delivery"]</label>
                            <div class="col-sm-9">
                                <input type="number" class="form-control" asp-for="PricePerDelivery" placeholder="@_CommonLocalizer["Price/Delivery"]">
                                <span asp-validation-for="PricePerDelivery" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["PriceRange"]</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control disablePointerEvents" asp-for="PriceRange" placeholder="@_CommonLocalizer["PriceRange"]">
                               
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["Description"]</label>
                            <div class="col-sm-9">
                                <textarea autocomplete="off" class="form-control" asp-for="Description" placeholder="@_CommonLocalizer["Description"]"> </textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="mt-3">
                                <button type="submit" class="btn btn-primary">@_CommonLocalizer["SaveBtn"]</button>
                                <a asp-controller="Celebrity" asp-action="Index" class="btn btn-secondary">@_CommonLocalizer["CancelBtn"]</a>
                            </div>
                        </div>
                    </form>

                </div>
                <div class="tab-pane fade" id="social" role="tabpanel" aria-labelledby="social-tab">
                    <form asp-controller="Celebrity" asp-action="EditSocialLink" method="post" id="SocialLinkForm">
                        <input type="hidden" asp-for="Id" />
                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["FbLink"]</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="@Model.FacebookLink" placeholder="@_CommonLocalizer["FbLink"]">
                                <span asp-validation-for="@Model.FacebookLink" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["InstLink"]</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="@Model.InstagramLink" placeholder="@_CommonLocalizer["InstLink"]">
                                <span asp-validation-for="@Model.InstagramLink" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["SCLink"]</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="@Model.SnapchatLink" placeholder="@_CommonLocalizer["SCLink"]">
                                <span asp-validation-for="@Model.SnapchatLink" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["TwitLink"]</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="@Model.TwitterLink" placeholder="@_CommonLocalizer["TwitLink"]">
                                <span asp-validation-for="@Model.TwitterLink" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["ThreadsLink"]</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="@Model.ThreadsLink" placeholder="@_CommonLocalizer["ThreadsLink"]">
                                <span asp-validation-for="@Model.ThreadsLink" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["YTLink"]</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="@Model.YoutubeLink" placeholder="@_CommonLocalizer["YTLink"]">
                                <span asp-validation-for="@Model.YoutubeLink" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="mt-3">
                                <button type="submit" class="btn btn-primary">@_CommonLocalizer["SaveBtn"]</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="tab-pane fade" id="attachment" role="tabpanel" aria-labelledby="attachment-tab">
                    <div class="row mb-3">
                        <label class="col-sm-3 col-form-label">@_CommonLocalizer["CivId"]</label>
                        <div class="col-sm-9">
                            <div class="d-flex align-items-center position-relative" style="display: inline-block;">

                                <img class="img-lg previewImage" src="@(!string.IsNullOrEmpty(Model.CivilIdAttachment.FilePath) ? Model.CivilIdAttachment.FilePath : "/images/others/placeholder.jpg")" alt="Civil Id" id="civilId" style="width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc;">

                                @if (Model.CivilIdAttachment.Id > 0)
                                {
                                    <button type="button" data-attachmentId="@Model.CivilIdAttachment.Id" class="btn btn-danger btn-sm position-absolute deleteImage" style="top: 5px; right: 5px;">
                                        <i class="fas fa-times"></i>
                                    </button>
                                }
                            </div>
                            <div class="row mt-1 uploadDiv">
                                <div class="col-10 d-flex align-items-center">

                                    <input type="file" class="form-control imageInput" data-image-container="civilId" accept=".jpg, .jpeg, .png" onchange="previewImage(event)">
                                </div>

                                <div class="col-2 d-flex align-items-center">

                                    <button type="button" class="btn btn-success ms-2 saveImage" data-type="CivilId" data-celebrityId="@Model.Id">
                                        <i class="fas fa-save"></i> @_CommonLocalizer["SaveBtn"]
                                    </button>
                                </div>

                            </div>
                        </div>
                        <div class="row mb-3 mt-2">
                            <label class="col-sm-3 col-form-label">@_CommonLocalizer["Contract"]</label>
                            <div class="col-sm-9">
                                <div class="d-flex align-items-center position-relative" style="display: inline-block;">

                                    <img class="img-lg previewImage" src="@(!string.IsNullOrEmpty(Model.ContractAttachment.FilePath) ? Model.ContractAttachment.FilePath : "/images/others/placeholder.jpg")" alt="Contract" id="contract" style="width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc;">
                                    @if (Model.ContractAttachment.Id > 0)
                                    {
                                        <button type="button" data-attachmentId="@Model.CivilIdAttachment.Id" class="btn btn-danger btn-sm position-absolute deleteImage" style="top: 5px; right: 5px;">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    }

                                </div>
                                <div class="row mt-1 uploadDiv">
                                    <div class="col-10 d-flex align-items-center">

                                        <input type="file" class="form-control imageInput" data-image-container="contract" accept=".jpg, .jpeg, .png" onchange="previewImage(event)">
                                    </div>

                                    <div class="col-2 d-flex align-items-center">

                                        <button type="button" class="btn btn-success ms-2 saveImage" data-type="Contract" data-celebrityId="@Model.Id">
                                            <i class="fas fa-save"></i> @_CommonLocalizer["SaveBtn"]
                                        </button>
                                    </div>

                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>
@section Scripts {
    <script>
        $(document).ready(function () {
            var activeTab = localStorage.getItem('activeTab');
            if (activeTab) {
                $('#lineTab a[href="' + activeTab + '"]').tab('show');
            } else {

                $('#lineTab a:first').tab('show');
            }
            localStorage.clear();

            const $pricePerPostInput = $('input[name="PricePerPost"]');
            const $pricePerEventInput = $('input[name="PricePerEvent"]');
            const $pricePerDeliveryInput = $('input[name="PricePerDelivery"]');
            const $priceRangeInput = $('#PriceRange');
            function calculatePriceRange() {
                const pricePerPost = parseFloat($pricePerPostInput.val());
                const pricePerEvent = parseFloat($pricePerEventInput.val());
                const pricePerDelivery = parseFloat($pricePerDeliveryInput.val());


                if (!isNaN(pricePerPost) && !isNaN(pricePerEvent) && !isNaN(pricePerDelivery)) {

                    const prices = [pricePerPost, pricePerEvent, pricePerDelivery].sort((a, b) => a - b);

                    $priceRangeInput.val(`${prices[0]} - ${prices[2]}`);
                } else {
                    $priceRangeInput.val(''); 
                }
            }
           
            $pricePerPostInput.on('input', calculatePriceRange);
            $pricePerEventInput.on('input', calculatePriceRange);
            $pricePerDeliveryInput.on('input', calculatePriceRange);
        });

        $(document).on("submit", function () {
            var activeTab = $('#lineTab .active').attr('href');
            localStorage.setItem('activeTab', activeTab);
        })

        $(document).on("click", ".deleteImage", function () {
            const title = "Do you really want to delete?";
            const attachmentId = $(this).attr("data-attachmentId");
            ShowDialog("Delete Image", title, "warning").then((result) => {
                if (result.isConfirmed) {
                    blockwindow();
                    $.ajax({
                        type: "Patch",
                        url: "/Celebrity/DeleteAttachment?id=" + attachmentId,
                        success: function (response) {
                            if (response.Status == "Success") {
                                SuccessToast(response.Message);
                                var activeTab = $('#lineTab .active').attr('href');
                                localStorage.setItem('activeTab', activeTab);
                                window.location.reload();
                            }
                            else {
                                InfoToast(response.Errors.join("\n"))
                            }
                            unblockwindow()

                        },
                        error: function (response) {
                            unblockwindow();
                            handleAjaxError(response)
                        },
                    });
                } else {
                }
            });
            return false;
        })


        $('.saveImage').on('click', function () {
            var $fileInput = $(this).closest('.uploadDiv').find('.imageInput');
            if ($fileInput[0].files.length === 0) {
                InfoToast('Please select a file.');
                return;
            }
            var formData = new FormData();
            formData.append('File', $fileInput[0].files[0]);
            formData.append('Type', $(this).data('type'));
            formData.append('CelebrityId', $(this).data('celebrityid'));
            ShowDialog("Upload Image", "Do you want to save this attachment", "warning").then((result) => {
                if (result.isConfirmed) {
                    blockwindow();
                    $.ajax({
                        url: '/Celebrity/UploadImage',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (response) {
                            if (response.Status == "Success") {
                                SuccessToast(response.Message);
                                var activeTab = $('#lineTab .active').attr('href');
                                localStorage.setItem('activeTab', activeTab);
                                window.location.reload();
                            }
                            else {
                                InfoToast(response.Errors.join("\n"))
                            }
                            unblockwindow();

                        },
                        error: function (response) {
                            unblockwindow();
                            handleAjaxError(response)
                        }
                    });
                } else {
                }
            });
            return false;


        });


    </script>
}
